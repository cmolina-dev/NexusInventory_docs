sequenceDiagram
    participant Admin as ğŸ‘¤ Tenant Admin
    participant Cloud as â˜ï¸ Backend Cloud
    participant SedeA as ğŸª Sede A (Solicitante)
    participant SedeB as ğŸ­ Sede B (Origen)
    
    Note over Admin,SedeB: Escenario: Sede A necesita 50 unidades de "Producto X"
    
    Admin->>Cloud: 1. Solicitar transferencia<br/>(50 unidades de Sede B a Sede A)
    
    Cloud->>Cloud: 2. Validar que ambas sedes<br/>estÃ©n ONLINE
    
    alt Alguna sede estÃ¡ OFFLINE
        Cloud-->>Admin: âŒ Error: No se puede transferir.<br/>Sede B estÃ¡ offline.
    else Ambas sedes ONLINE
        Cloud->>SedeB: 3. Â¿Tienes 50 unidades disponibles?
        SedeB->>SedeB: Consulta inventario local
        
        alt Stock insuficiente
            SedeB-->>Cloud: âŒ Solo tengo 30 unidades
            Cloud-->>Admin: âŒ Transferencia rechazada:<br/>Stock insuficiente
        else Stock disponible
            SedeB-->>Cloud: âœ… Tengo 50 unidades disponibles
            Cloud->>SedeB: 4. Notificar solicitud pendiente<br/>(requiere aprobaciÃ³n)
            
            Note over SedeB: Gerente de Sede B revisa solicitud
            
            SedeB->>Cloud: 5. Aprobar transferencia
            
            Cloud->>Cloud: 6. Ejecutar transferencia atÃ³mica:<br/>- Registrar en Main DB<br/>- Crear transacciÃ³n salida Sede B<br/>- Crear transacciÃ³n entrada Sede A
            
            par ActualizaciÃ³n en paralelo
                Cloud->>SedeB: Push: TransacciÃ³n salida -50
                SedeB->>SedeB: Actualizar IndexedDB local<br/>(Stock: 100 â†’ 50)
            and
                Cloud->>SedeA: Push: TransacciÃ³n entrada +50
                SedeA->>SedeA: Actualizar IndexedDB local<br/>(Stock: 20 â†’ 70)
            end
            
            Cloud-->>Admin: âœ… Transferencia completada
            
            Note over SedeA,SedeB: Ambas sedes pueden operar offline<br/>con su nuevo inventario actualizado
        end
    end
    
    Note over Admin,SedeB: Si alguna sede se desconecta durante el proceso,<br/>la transferencia se marca como "pendiente" y se reintenta.
